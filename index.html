<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Covenant Alignment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .slide-in { animation: slideIn 0.3s ease-out forwards; }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Rise Brand Colors */
        :root {
            --rise-red: #E40046;
            --rise-teal: #00B2A9;
            --rise-navy: #2D324D;
            --rise-charcoal: #3C4247;
        }

        /* Custom Radio Styling for Drift Section */
        .drift-radio:checked + label {
            font-weight: 700;
            border-color: transparent;
        }
        
        /* Specific Colors for Frequency */
        .drift-radio:checked + label.btn-never {
            background-color: #dcfce7; color: #166534; /* Green */
        }
        .drift-radio:checked + label.btn-rarely {
            background-color: #f1f5f9; color: #475569; /* Slate/Gray */
        }
        .drift-radio:checked + label.btn-sometimes {
            background-color: #fef9c3; color: #854d0e; /* Yellow */
        }
        .drift-radio:checked + label.btn-often {
            background-color: #fee2e2; color: #991b1b; /* Red */
        }

        /* Standard Radio Styling */
        .tf-radio:checked + label.true-btn {
            background-color: #00B2A9; color: white; border-color: #00B2A9; /* Rise Teal for Positive */
        }
        .tf-radio:checked + label.false-btn {
            background-color: #E40046; color: white; border-color: #E40046; /* Rise Red for Negative */
        }
        .trait-radio:checked + label {
            background-color: #2D324D; color: white; border-color: #2D324D; /* Rise Navy for Selection */
        }

        @media print {
            .no-print { display: none; }
            body { background: white; }
            .shadow-lg { shadow: none; }
            .print-break-inside-avoid { break-inside: avoid; }
            /* Force layout for grid printing */
            .print-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        }
    </style>
</head>
<body class="bg-gray-50 text-[#3C4247] min-h-screen pb-20">

    <!-- Navbar -->
    <nav class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50 no-print">
        <div class="max-w-3xl mx-auto px-4 py-4 flex justify-between items-center">
            <button onclick="location.reload()" class="font-bold text-xl text-[#2D324D] tracking-tight flex items-center gap-3 hover:opacity-75 transition-opacity text-left">
                <img src="https://images.squarespace-cdn.com/content/v1/586c2259579fb3ccd8b5cd4a/1503978477490-86FAD7OFE2UR0K75OXH2/Icon.png?format=1500w" class="h-8 w-auto" alt="Logo">
                The Covenant Alignment
            </button>
            <div id="nav-badge" class="text-xs font-semibold text-gray-400 uppercase tracking-wide hidden sm:block">
                Select Version
            </div>
        </div>
    </nav>

    <div class="max-w-3xl mx-auto px-4 py-8">
        
        <!-- MODE SELECTION (First Screen) -->
        <div id="mode-selection" class="slide-in">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-[#2D324D] mb-2">Whose alignment are we checking?</h1>
                <p class="text-gray-500">Select the appropriate path to begin.</p>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Husband Option -->
                <button onclick="setMode('husband')" class="bg-white p-6 rounded-2xl shadow-sm border-2 border-transparent hover:border-[#2D324D] transition-all group text-left">
                    <div class="w-12 h-12 bg-[#2D324D]/10 rounded-full flex items-center justify-center mb-4 group-hover:bg-[#2D324D] group-hover:text-white transition-colors text-[#2D324D]">
                        <i class="fa-solid fa-user-tie text-xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-[#2D324D] mb-1">Husband Alignment</h3>
                    <p class="text-xs text-gray-500">Wife fills this out regarding her husband's leadership.</p>
                </button>

                <!-- Wife Option -->
                <button onclick="setMode('wife')" class="bg-white p-6 rounded-2xl shadow-sm border-2 border-transparent hover:border-[#E40046] transition-all group text-left">
                    <div class="w-12 h-12 bg-[#E40046]/10 rounded-full flex items-center justify-center mb-4 group-hover:bg-[#E40046] group-hover:text-white transition-colors text-[#E40046]">
                        <i class="fa-solid fa-user text-xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-[#2D324D] mb-1">Wife Alignment</h3>
                    <p class="text-xs text-gray-500">Husband fills this out regarding his wife's influence.</p>
                </button>
            </div>
        </div>

        <!-- Intro Card (Dynamic) -->
        <div id="audit-intro" class="hidden bg-white p-8 rounded-2xl shadow-sm border border-gray-200 text-center mb-8 slide-in">
            <div class="w-24 h-24 mx-auto mb-6">
                <img src="https://images.squarespace-cdn.com/content/v1/586c2259579fb3ccd8b5cd4a/1503978477490-86FAD7OFE2UR0K75OXH2/Icon.png?format=1500w" class="w-full h-full object-contain" alt="Logo">
            </div>
            
            <div class="flex justify-center gap-2 mb-6 text-[10px] sm:text-xs font-bold uppercase tracking-wider text-gray-500">
                <span class="bg-gray-100 px-4 py-1.5 rounded-full" id="intro-focus">FOCUS: THE HUSBAND</span>
                <span class="bg-gray-100 px-4 py-1.5 rounded-full" id="intro-input">INPUT: THE WIFE</span>
            </div>

            <h2 class="text-3xl sm:text-4xl font-bold text-[#2D324D] mb-6">The Covenant Alignment</h2>
            
            <p class="text-gray-600 mb-8 leading-relaxed max-w-lg mx-auto text-sm sm:text-base">
                <strong class="text-[#3C4247]">Our Purpose:</strong> Marriage is a covenant, not a contract. This tool helps us honor that covenant by moving from guessing to knowing. By offering honest feedback on the four key domains (<span class="font-bold text-[#E40046]">Relational, Spiritual, Financial, Health</span>), we align our actions with our vows.
            </p>

            <div class="max-w-lg mx-auto mb-10 bg-gray-50 rounded-lg p-6 border-l-4 border-[#2D324D] text-left">
                <span class="block text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-3">Our Heart Posture</span>
                <p class="text-[#2D324D] italic text-lg mb-3 font-serif leading-relaxed">"Instead, speaking the truth in love, we will grow to become in every respect the mature body of him who is the head, that is, Christ."</p>
                <p class="text-xs text-gray-500 uppercase font-bold tracking-wider">— Ephesians 4:15</p>
            </div>

            <button onclick="startAudit()" class="bg-[#E40046] text-white font-bold py-3 px-10 rounded-lg shadow-lg hover:bg-[#C0003A] transition transform hover:scale-105 mb-6">
                Start Review
            </button>
            
            <!-- Privacy Note -->
            <div class="flex items-center justify-center gap-2 text-xs text-gray-400">
                <i class="fa-solid fa-lock"></i>
                <span>Anonymous & Private. No data is saved/stored.</span>
            </div>
        </div>

        <!-- Audit Form Content -->
        <div id="audit-content" class="hidden space-y-8 slide-in">
            <form id="auditForm" onsubmit="generateAuditReport(event)">
                
                <!-- Part 1: The Drift Detector -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-orange-100">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="bg-orange-50 text-orange-700 font-bold py-1 px-3 rounded text-xs uppercase">Part 1</span>
                        <h3 class="text-xl font-bold text-[#2D324D]">The Stress Check (Drift)</h3>
                    </div>
                    
                    <div class="bg-orange-50/50 rounded-lg p-4 mb-6 border border-orange-100 flex items-start gap-3">
                        <i class="fa-solid fa-circle-info text-orange-600 mt-0.5"></i>
                        <p class="text-sm text-orange-800 leading-relaxed" id="drift-instruction">...</p>
                    </div>

                    <div class="mb-6">
                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-3">Internal & Character</h4>
                        <div class="space-y-3" id="internal-flags"></div>
                    </div>
                    
                    <div>
                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wide mb-3">Relational & Behavioral</h4>
                        <div class="space-y-3" id="relational-flags"></div>
                    </div>
                </div>

                <!-- Part 2: The 4 Domains (Reality Check) -->
                <div>
                    <div class="flex items-center gap-3 mb-6 mt-10">
                        <span class="bg-[#E40046] text-white font-bold py-1 px-3 rounded text-xs uppercase">Part 2</span>
                        <h3 class="text-xl font-bold text-[#2D324D]">Life Domains</h3>
                    </div>
                    
                    <!-- Relational -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-[#2D324D] mb-4 flex items-center"><i class="fa-solid fa-users mr-2 text-[#E40046]"></i> Relational</h4>
                        <div id="domain-relational" class="space-y-6"></div>
                    </div>

                    <!-- Spiritual -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-[#2D324D] mb-4 flex items-center"><i class="fa-solid fa-church mr-2 text-[#E40046]"></i> Spiritual</h4>
                        <div id="domain-spiritual" class="space-y-6"></div>
                    </div>

                    <!-- Financial -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-[#2D324D] mb-4 flex items-center"><i class="fa-solid fa-coins mr-2 text-[#E40046]"></i> Financial</h4>
                        <div id="domain-financial" class="space-y-6"></div>
                    </div>

                     <!-- Health -->
                     <div class="mb-8">
                        <h4 class="text-lg font-bold text-[#2D324D] mb-4 flex items-center"><i class="fa-solid fa-heart-pulse mr-2 text-[#E40046]"></i> Health</h4>
                        <div id="domain-health" class="space-y-6"></div>
                    </div>
                </div>

                <!-- Part 3: Trait Scale -->
                <div>
                    <div class="flex items-center gap-3 mb-4 mt-8">
                        <span class="bg-[#E40046] text-white font-bold py-1 px-3 rounded text-xs uppercase">Part 3</span>
                        <h3 class="text-xl font-bold text-[#2D324D]">Character Traits</h3>
                    </div>
                    <div id="trait-questions" class="space-y-6"></div>
                </div>

                <div class="pt-8 pb-12">
                    <button type="submit" class="w-full bg-[#3C4247] hover:bg-[#2D324D] text-white font-bold py-4 rounded-xl shadow-xl transition-all text-lg">
                        Generate Alignment Report
                    </button>
                </div>
            </form>
        </div>

        <!-- Audit Results Report -->
        <div id="audit-results" class="hidden slide-in">
            <!-- Header -->
            <div class="flex justify-between items-end mb-4 no-print">
                <h2 class="text-2xl font-bold text-[#2D324D]">Alignment Report</h2>
                <button onclick="window.print()" class="text-[#E40046] font-semibold text-sm hover:underline">
                    <i class="fa-solid fa-print"></i> Save PDF
                </button>
            </div>

            <!-- Not Saved Alert -->
            <div class="bg-[#E40046]/10 border-l-4 border-[#E40046] p-4 mb-6 rounded-r no-print">
                <p class="text-[#E40046] text-sm font-medium">
                    <i class="fa-solid fa-circle-info mr-2"></i>
                    Results are not saved online. Please download the PDF now if you wish to keep a copy.
                </p>
            </div>

            <!-- Score Card (Gradient from Rise Red to Rise Teal) -->
             <div class="bg-gradient-to-br from-[#E40046] to-[#00B2A9] rounded-2xl p-6 text-white shadow-lg mb-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-white/80 font-medium uppercase tracking-wider text-xs mb-1" id="report-subject-label">Subject's Alignment</h3>
                        <div class="text-3xl font-bold" id="result-summary-text">Developing</div>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl font-bold" id="result-avg-score">0.0</div>
                        <div class="text-xs text-white/80">Avg Alignment Score</div>
                    </div>
                </div>
            </div>
            
            <!-- 1. The Drift Report (Complete) -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-6 print-break-inside-avoid">
                <div class="bg-gray-50 px-6 py-3 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="font-bold text-[#3C4247] text-sm uppercase"><i class="fa-solid fa-compass mr-2"></i> The Drift Report</h3>
                </div>
                <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6 print-grid">
                    
                    <!-- Left Col: The Work (Areas of Concern) -->
                    <div class="space-y-6">
                         <!-- Often Section -->
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-2 h-2 rounded-full bg-red-600"></span>
                                <span class="text-xs font-bold text-red-700 uppercase tracking-wide">Consistent Struggles (Often)</span>
                            </div>
                            <div id="report-often" class="flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        <!-- Sometimes Section -->
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
                                <span class="text-xs font-bold text-yellow-700 uppercase tracking-wide">Occasional / Stress Drift (Sometimes)</span>
                            </div>
                            <div id="report-sometimes" class="flex flex-wrap gap-2 mt-2"></div>
                        </div>
                    </div>

                    <!-- Right Col: The Wins (Areas of Strength) -->
                    <div class="space-y-6">
                        <!-- Rarely Section -->
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-2 h-2 rounded-full bg-gray-400"></span>
                                <span class="text-xs font-bold text-gray-500 uppercase tracking-wide">Rarely Seen</span>
                            </div>
                            <div id="report-rarely" class="flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        <!-- Never Section -->
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="w-2 h-2 rounded-full bg-green-500"></span>
                                <span class="text-xs font-bold text-green-700 uppercase tracking-wide">Winning (Never Seen)</span>
                            </div>
                            <div id="report-never" class="flex flex-wrap gap-2 mt-2"></div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- 2. Reality Check Report -->
            <div class="space-y-6 mb-8">
                <!-- Relational -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print-break-inside-avoid">
                    <div class="bg-gray-50 px-6 py-3 border-b border-gray-200">
                        <h3 class="font-bold text-[#3C4247] text-sm uppercase"><i class="fa-solid fa-users mr-2 text-[#E40046]"></i> Relational Health</h3>
                    </div>
                    <div class="divide-y divide-gray-100" id="report-relational"></div>
                </div>

                <!-- Spiritual -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print-break-inside-avoid">
                    <div class="bg-gray-50 px-6 py-3 border-b border-gray-200">
                        <h3 class="font-bold text-[#3C4247] text-sm uppercase"><i class="fa-solid fa-church mr-2 text-[#E40046]"></i> Spiritual Health</h3>
                    </div>
                    <div class="divide-y divide-gray-100" id="report-spiritual"></div>
                </div>

                <!-- Financial -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print-break-inside-avoid">
                    <div class="bg-gray-50 px-6 py-3 border-b border-gray-200">
                        <h3 class="font-bold text-[#3C4247] text-sm uppercase"><i class="fa-solid fa-coins mr-2 text-[#E40046]"></i> Financial Health</h3>
                    </div>
                    <div class="divide-y divide-gray-100" id="report-financial"></div>
                </div>

                <!-- Health -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden print-break-inside-avoid">
                    <div class="bg-gray-50 px-6 py-3 border-b border-gray-200">
                        <h3 class="font-bold text-[#3C4247] text-sm uppercase"><i class="fa-solid fa-heart-pulse mr-2 text-[#E40046]"></i> Physical Health</h3>
                    </div>
                    <div class="divide-y divide-gray-100" id="report-health"></div>
                </div>
            </div>

            <!-- 3. Trait Scale Report -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden mb-8 print-break-inside-avoid">
                <div class="bg-gray-50 px-6 py-3 border-b border-gray-200">
                    <h3 class="font-bold text-[#3C4247] text-sm uppercase"><i class="fa-solid fa-scale-balanced mr-2 text-[#E40046]"></i> Character Traits</h3>
                </div>
                <div class="divide-y divide-gray-100" id="report-traits"></div>
            </div>

            <button onclick="location.reload()" class="w-full border border-gray-300 py-3 rounded-lg text-gray-500 hover:bg-gray-50 no-print">
                Start New Alignment
            </button>
        </div>
    </div>

    <script>
        // --- CONFIG & STATE ---
        let currentMode = 'husband'; // 'husband' or 'wife'

        // --- DATA OBJECTS ---
        const DATA = {
            husband: {
                focus: "FOCUS: THE HUSBAND",
                input: "INPUT: THE WIFE",
                driftInstruction: "<strong>To the Wife:</strong> We all drift when we are tired or stressed. Helping him identify where he tends to drift isn't criticism—it's giving him a map to get back on track.",
                internalFlags: ["Selfish", "Immoral", "Prideful", "Unmotivated", "Mistrust", "Lack of Vulnerability"],
                relationalFlags: ["Micromanaging", "Bullying", "Mean / Toxic", "Cliquish", "Devaluing People"],
                domains: {
                    relational: [
                        { id: 'presence', text: 'When he walks through the door, phone goes away and he is mentally "here".' },
                        { id: 'listening', text: 'He listens to understand emotions before trying to fix the problem.' },
                        { id: 'tone', text: 'His tone with the family is patient, not sharp or condescending.' },
                        { id: 'romance', text: 'He consistently pursues me (dates, affection) without prompting.' },
                        { id: 'safety', text: 'I feel safe sharing "hard truths" without fear of defensiveness.' }
                    ],
                    spiritual: [
                        { id: 'spirit_lead', text: 'He actively leads the spiritual temperature of the home (prayer, conversation).' },
                        { id: 'spirit_consist', text: 'His public faith matches his private life (Integrity).' },
                        { id: 'discipline', text: 'He leads discipline with calmness and biblical instruction, not anger.' }
                    ],
                    financial: [
                        { id: 'fin_transparency', text: 'He is transparent about our finances; we are a team.' },
                        { id: 'fin_stewardship', text: 'He manages resources wisely and leads us in generosity.' },
                        { id: 'fin_vision', text: 'He initiates conversations about our financial goals/future.' }
                    ],
                    health: [
                        { id: 'health_energy', text: 'He manages his energy so he has something left for us at the end of the day.' },
                        { id: 'health_control', text: 'He models self-control in physical habits (food, substance, screen time).' }
                    ]
                },
                traits: [
                    { id: 'humility', label: 'Humility', poor: 'Prideful / Selfish', rich: 'Humility / Service' },
                    { id: 'patience', label: 'Patience', poor: 'Mean / Toxic', rich: 'Patience / Gentle' },
                    { id: 'empowerment', label: 'Empowerment', poor: 'Micromanaging', rich: 'Empowering / Trusting' },
                    { id: 'connection', label: 'Connection', poor: 'Cliquish / Devaluing', rich: 'Inclusive / Valuing' },
                    { id: 'vulnerability', label: 'Vulnerability', poor: 'Mistrust / Closed', rich: 'Open / Vulnerable' },
                    { id: 'drive', label: 'Drive', poor: 'Unmotivated', rich: 'Initiative / Owner' }
                ]
            },
            wife: {
                focus: "FOCUS: THE WIFE",
                input: "INPUT: THE HUSBAND",
                driftInstruction: "<strong>To the Husband:</strong> Stress affects everyone. Identifying her 'drift' behaviors helps you understand her needs and pray for her more effectively.",
                internalFlags: ["Anxious", "Critical", "Insecure", "Discontent", "Unforgiving", "Prideful"],
                relationalFlags: ["Disrespectful", "Nagging", "Withholding Affection", "Controlling", "Cold / Distant"],
                domains: {
                    relational: [
                        { id: 'respect', text: 'She speaks to me with respect, both in private and in public (Eph 5:33).' },
                        { id: 'peace', text: 'She helps create a peaceful atmosphere in the home.' },
                        { id: 'listening', text: 'She listens to my thoughts without interrupting or immediately correcting.' },
                        { id: 'belief', text: 'She communicates belief in me and my leadership.' },
                        { id: 'warmth', text: 'She is physically affectionate and open to intimacy.' }
                    ],
                    spiritual: [
                        { id: 'spirit_walk', text: 'She prioritizes her own daily walk with God.' },
                        { id: 'wisdom', text: 'She brings biblical wisdom and discernment into our decisions.' },
                        { id: 'nurture', text: 'She actively nurtures the faith of our children (if applicable).' }
                    ],
                    financial: [
                        { id: 'contentment', text: 'She practices contentment with what we have.' },
                        { id: 'stewardship', text: 'She partners with me in managing our resources wisely.' },
                        { id: 'trust', text: 'She trusts our financial plan and supports our giving goals.' }
                    ],
                    health: [
                        { id: 'self_care', text: 'She prioritizes her physical health and rest.' },
                        { id: 'stress_mgmt', text: 'She manages her stress levels in healthy ways.' }
                    ]
                },
                traits: [
                    { id: 'respect', label: 'Respect', poor: 'Disrespectful / Dismissive', rich: 'Respectful / Honoring' },
                    { id: 'gentleness', label: 'Gentleness', poor: 'Harsh / Sharp', rich: 'Gentle / Kind' },
                    { id: 'support', label: 'Support', poor: 'Critical / Tearing Down', rich: 'Encouraging / Building Up' },
                    { id: 'patience', label: 'Patience', poor: 'Irritable / Anxious', rich: 'Patient / Peaceful' },
                    { id: 'wisdom', label: 'Wisdom', poor: 'Reactive / Emotional', rich: 'Wise / Prudent' },
                    { id: 'kindness', label: 'Kindness', poor: 'Cold / Distant', rich: 'Warm / Engaging' }
                ]
            }
        };

        // --- INIT & MODE SWITCHING ---
        function setMode(mode) {
            currentMode = mode;
            const data = DATA[mode];
            
            // Hide selection, show intro
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('audit-intro').classList.remove('hidden');
            
            // Update Text
            document.getElementById('nav-badge').innerText = mode === 'husband' ? 'Husband Alignment' : 'Wife Alignment';
            document.getElementById('intro-focus').innerText = data.focus;
            document.getElementById('intro-input').innerText = data.input;
            document.getElementById('drift-instruction').innerHTML = data.driftInstruction;
            
            // Pre-render form to be ready
            renderAudit();
        }

        function startAudit() {
            document.getElementById('audit-intro').classList.add('hidden');
            document.getElementById('audit-content').classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // --- RENDER FORM ---
        function renderAudit() {
            const data = DATA[currentMode];

            const renderDriftRow = (f, idx, prefix) => `
                <div class="border-b border-gray-100 py-4 last:border-0">
                    <div class="text-sm font-semibold text-[#3C4247] mb-2">${f}</div>
                    <div class="grid grid-cols-4 gap-2">
                        <!-- Never -->
                        <input type="radio" name="drift_${prefix}_${idx}" id="drift_${prefix}_${idx}_never" value="never" class="hidden drift-radio" checked>
                        <label for="drift_${prefix}_${idx}_never" class="btn-never py-2 text-[10px] sm:text-xs text-center border border-gray-200 rounded-md text-gray-500 bg-white cursor-pointer hover:bg-green-50 transition-all">Never</label>
                        
                        <!-- Rarely -->
                        <input type="radio" name="drift_${prefix}_${idx}" id="drift_${prefix}_${idx}_rarely" value="rarely" class="hidden drift-radio">
                        <label for="drift_${prefix}_${idx}_rarely" class="btn-rarely py-2 text-[10px] sm:text-xs text-center border border-gray-200 rounded-md text-gray-500 bg-white cursor-pointer hover:bg-gray-50 transition-all">Rarely</label>
                        
                        <!-- Sometimes -->
                        <input type="radio" name="drift_${prefix}_${idx}" id="drift_${prefix}_${idx}_sometimes" value="sometimes" class="hidden drift-radio">
                        <label for="drift_${prefix}_${idx}_sometimes" class="btn-sometimes py-2 text-[10px] sm:text-xs text-center border border-gray-200 rounded-md text-gray-500 bg-white cursor-pointer hover:bg-yellow-50 transition-all">Sometimes</label>
                        
                        <!-- Often -->
                        <input type="radio" name="drift_${prefix}_${idx}" id="drift_${prefix}_${idx}_often" value="often" class="hidden drift-radio">
                        <label for="drift_${prefix}_${idx}_often" class="btn-often py-2 text-[10px] sm:text-xs text-center border border-gray-200 rounded-md text-gray-500 bg-white cursor-pointer hover:bg-red-50 transition-all">Often</label>
                    </div>
                    <input type="hidden" name="label_${prefix}_${idx}" value="${f}">
                </div>`;
            
            document.getElementById('internal-flags').innerHTML = data.internalFlags.map((f, i) => renderDriftRow(f, i, 'int')).join('');
            document.getElementById('relational-flags').innerHTML = data.relationalFlags.map((f, i) => renderDriftRow(f, i, 'rel')).join('');

            // Domains Loop
            const renderQ = (q) => `
                <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                    <p class="font-bold text-[#3C4247] text-sm mb-3">${q.text}</p>
                    <div class="flex gap-2 mb-3">
                        <input type="radio" name="${q.id}" id="${q.id}_t" value="true" class="hidden tf-radio">
                        <label for="${q.id}_t" class="true-btn flex-1 py-3 rounded-lg border border-gray-200 bg-gray-50 text-center text-sm font-bold cursor-pointer transition-all">TRUE</label>
                        
                        <input type="radio" name="${q.id}" id="${q.id}_f" value="false" class="hidden tf-radio">
                        <label for="${q.id}_f" class="false-btn flex-1 py-3 rounded-lg border border-gray-200 bg-gray-50 text-center text-sm font-bold cursor-pointer transition-all">FALSE</label>
                    </div>
                    <textarea name="${q.id}_notes" placeholder="Context / Examples..." class="w-full text-sm p-3 border border-gray-200 rounded-lg bg-gray-50 focus:bg-white focus:ring-2 focus:ring-[#E40046] outline-none" rows="1"></textarea>
                </div>
            `;

            document.getElementById('domain-relational').innerHTML = data.domains.relational.map(renderQ).join('');
            document.getElementById('domain-spiritual').innerHTML = data.domains.spiritual.map(renderQ).join('');
            document.getElementById('domain-financial').innerHTML = data.domains.financial.map(renderQ).join('');
            document.getElementById('domain-health').innerHTML = data.domains.health.map(renderQ).join('');

            // Traits
            document.getElementById('trait-questions').innerHTML = data.traits.map(q => `
                <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                    <div class="flex justify-between items-end mb-2">
                        <span class="font-bold text-[#3C4247] text-base">${q.label}</span>
                    </div>
                    <div class="flex justify-between text-[10px] uppercase font-bold tracking-wider mb-2 px-1">
                        <span class="text-red-400">${q.poor}</span>
                        <span class="text-green-600 text-right">${q.rich}</span>
                    </div>
                    <div class="flex gap-1 mb-3">
                        ${[1,2,3,4,5].map(n => `
                            <input type="radio" name="${q.id}" id="${q.id}_${n}" value="${n}" class="hidden trait-radio">
                            <label for="${q.id}_${n}" class="flex-1 py-3 rounded-lg border border-gray-200 bg-gray-50 text-center font-bold text-gray-500 cursor-pointer hover:bg-gray-100 transition-all">${n}</label>
                        `).join('')}
                    </div>
                    <textarea name="${q.id}_notes" placeholder="The 'Why'..." class="w-full text-sm p-3 border border-gray-200 rounded-lg bg-gray-50 focus:bg-white focus:ring-2 focus:ring-[#E40046] outline-none" rows="1"></textarea>
                </div>
            `).join('');
        }

        // --- GENERATE REPORT ---
        function generateAuditReport(e) {
            e.preventDefault();
            const fd = new FormData(e.target);
            const data = DATA[currentMode];
            
            // 1. Process Drift/Frequency
            const sometimesItems = [];
            const oftenItems = [];
            const rarelyItems = [];
            const neverItems = [];

            const checkDrift = (count, prefix) => {
                for(let i=0; i<count; i++) {
                    const val = fd.get(`drift_${prefix}_${i}`);
                    const label = fd.get(`label_${prefix}_${i}`);
                    if(val === 'sometimes') sometimesItems.push(label);
                    if(val === 'often') oftenItems.push(label);
                    if(val === 'rarely') rarelyItems.push(label);
                    if(val === 'never') neverItems.push(label);
                }
            };
            checkDrift(data.internalFlags.length, 'int');
            checkDrift(data.relationalFlags.length, 'rel');

            const createPills = (list, colorClass, borderClass, bgClass) => {
                return list.length > 0 
                ? list.map(f => `<span class="${bgClass} ${colorClass} px-3 py-1 rounded-full text-xs font-bold border ${borderClass}">${f}</span>`).join('')
                : '<span class="text-gray-400 italic text-xs">None</span>';
            }

            document.getElementById('report-often').innerHTML = createPills(oftenItems, 'text-red-700', 'border-red-200', 'bg-red-50');
            document.getElementById('report-sometimes').innerHTML = createPills(sometimesItems, 'text-yellow-800', 'border-yellow-200', 'bg-yellow-50');
            document.getElementById('report-rarely').innerHTML = createPills(rarelyItems, 'text-gray-600', 'border-gray-200', 'bg-gray-50');
            document.getElementById('report-never').innerHTML = createPills(neverItems, 'text-green-700', 'border-green-200', 'bg-green-50');

            // 2. Process Reality Check
            const processDomain = (qList, reportId) => {
                let html = '';
                qList.forEach(q => {
                    const val = fd.get(q.id); 
                    const note = fd.get(q.id + '_notes');
                    
                    let badge = '<span class="text-gray-400 text-xs font-medium">Skipped</span>';
                    if (val === 'true') badge = '<span class="text-[#00B2A9] bg-[#00B2A9]/10 px-2 py-1 rounded text-xs font-bold border border-[#00B2A9]/20">TRUE</span>';
                    if (val === 'false') badge = '<span class="text-[#E40046] bg-[#E40046]/10 px-2 py-1 rounded text-xs font-bold border border-[#E40046]/20">FALSE</span>';

                    html += `
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <p class="text-sm font-semibold text-[#3C4247] pr-4">${q.text}</p>
                            ${badge}
                        </div>
                        ${note ? `<div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg border border-gray-100 mt-2 italic">"${note}"</div>` : ''}
                    </div>`;
                });
                document.getElementById(reportId).innerHTML = html || '<p class="p-4 text-gray-400 italic">No answers.</p>';
            };

            processDomain(data.domains.relational, 'report-relational');
            processDomain(data.domains.spiritual, 'report-spiritual');
            processDomain(data.domains.financial, 'report-financial');
            processDomain(data.domains.health, 'report-health');

            // 3. Process Traits
            let traitHTML = '';
            let totalScore = 0;
            let count = 0;

            data.traits.forEach(q => {
                const val = parseInt(fd.get(q.id));
                const note = fd.get(q.id + '_notes');
                
                if(val) { totalScore += val; count++; }

                let scoreColor = 'text-yellow-600';
                if(val <= 2) scoreColor = 'text-[#E40046]';
                if(val >= 4) scoreColor = 'text-[#00B2A9]';
                
                const valDisplay = val ? `<span class="text-lg font-bold ${scoreColor}">${val}<span class="text-gray-300 text-xs font-normal">/5</span></span>` : '<span class="text-gray-300 text-xs">-</span>';

                traitHTML += `
                <div class="p-4 sm:p-6">
                    <div class="flex justify-between items-center mb-1">
                        <div>
                            <span class="font-bold text-[#3C4247] block">${q.label}</span>
                            <span class="text-[10px] text-gray-400 uppercase tracking-wide">${val <= 2 && val ? q.poor : val >= 4 ? q.rich : ''}</span>
                        </div>
                        ${valDisplay}
                    </div>
                    ${note ? `<div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-lg border border-gray-100 mt-2 italic">"${note}"</div>` : ''}
                </div>`;
            });
            document.getElementById('report-traits').innerHTML = traitHTML;

            // Summary Math
            const avg = count ? (totalScore/count).toFixed(1) : "0.0";
            document.getElementById('result-avg-score').innerText = avg;
            document.getElementById('result-summary-text').innerText = avg >= 4.5 ? "Exemplary" : avg >= 3.5 ? "Strong Foundation" : "Developing";
            
            // Dynamic Label
            document.getElementById('report-subject-label').innerText = currentMode === 'husband' ? "Husband's Alignment Health" : "Wife's Alignment Health";

            // View Switch
            document.getElementById('audit-content').classList.add('hidden');
            document.getElementById('audit-results').classList.remove('hidden');
            window.scrollTo(0,0);
        }
    </script>
</body>
</html>
